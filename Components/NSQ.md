# NSQ

[https://nsq.io/](https://nsq.io/)

[https://github.com/nsqio/nsq](https://github.com/nsqio/nsq)

与消息队列相关的协议和规范有JMS、AMQP、MQTT以及OpenMessaging，而MQTT中规定了三种传递标准：

```
At most once：至多一次。消息传递时，最多会被送达一次，没有什么可靠性，允许消息丢失。
At least once：至少一次。消息传递时，至少会被送打一次，保证消息可靠性，但存在多次消费的可能。
Exactly once：恰好一次。消息传递时，只会被送达一次，不允许丢失也不允许重复。
```

## 幂等

幂等（Idempotence） 本来是一个数学上的概念，它是这样定义的：
```
如果一个函数 f(x) 满足：f(f(x)) = f(x)，则函数 f(x) 满足幂等性。
```

一条数据重复出现两次，数据库里就只有一条数据，这就保证了系统的幂等性。

幂等性，通俗点说，就一个数据，或者一个请求，给你重复来多次，你得确保对应的数据是不会改变的，不能出错。

## 延时队列

nsq支持延时消息的投递，默认支持最大的毫秒数为3600000毫秒也就是60分钟，不过这个值可以在nsqd启动的时候用`-max-req-timeout`参数修改最大值。
